const apiUrl="https://pageusapi-production.up.railway.app";let statsId,conversionEvents={},attentionPoints=[],clicks=[],lastKnownMousePosition={x:null,y:null};document.addEventListener("mousemove",(t=>{lastKnownMousePosition.x=t.pageX,lastKnownMousePosition.y=t.pageY})),setInterval((()=>{if(null!==lastKnownMousePosition.x&&null!==lastKnownMousePosition.y){const t={x:lastKnownMousePosition.x,y:lastKnownMousePosition.y,timestamp:(new Date).toISOString()};attentionPoints.push(t)}}),5e3),document.addEventListener("click",(t=>{const e={x:t.pageX,y:t.pageY,timestamp:(new Date).toISOString()};clicks.push(e)}));let startTime=Date.now();async function UpdateStats(){if(!statsId)return!1;const t=Date.now(),e={statsId:statsId,interactionInfo:{clicks:clicks,attentionPoints:attentionPoints,duration:t-startTime,conversionEvents:conversionEvents}};try{if(!(await fetch(`${apiUrl}/stats`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok)throw new Error("Failed to send data")}catch(t){console.error("Error sending periodic data:",t)}}async function getIPInfo(){try{if("about:srcdoc"===window.location.href)return!1;const t=await fetch("https://ipv4.wtfismyip.com/json",{mode:"cors"}),e=await t.json();return{IPAddress:e.YourFuckingIPAddress,Location:e.YourFuckingLocation,Hostname:e.YourFuckingHostname,ISP:e.YourFuckingISP,TorExit:e.YourFuckingTorExit,City:e.YourFuckingCity,Country:e.YourFuckingCountry,CountryCode:e.YourFuckingCountryCode}}catch(t){throw console.error("Error fetching IP info:",t),t}}async function Stats(){try{const t=await getIPInfo(),e=t=>{var e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))&&0==e.toDataURL(t).indexOf("data:"+t)},n={pageInfo:{pageID:pageID,referrer:document.referrer,url:window.location.href,domain:extractDomain(window.location.href),slug:slugExtractor(window.location.href)},deviceInfo:{screenWidth:window.screen.width,screenHeight:window.screen.height,colorDepth:window.screen.colorDepth,userAgent:navigator.userAgent,language:navigator.language,deviceMemory:navigator.deviceMemory||"unknown",hardwareConcurrency:navigator.hardwareConcurrency,touchPoints:navigator.maxTouchPoints},browserInfo:{viewportWidth:window.innerWidth,viewportHeight:window.innerHeight,cookiesEnabled:navigator.cookieEnabled,doNotTrack:navigator.doNotTrack||"unknown",timeZoneOffset:(new Date).getTimezoneOffset(),supportsWebP:e("image/webp"),supportsWebGL:!!window.WebGLRenderingContext,supportsWebRTC:!!window.RTCPeerConnection},connectionInfo:{connectionType:navigator.connection?navigator.connection.type:"unknown",effectiveConnectionType:navigator.connection?navigator.connection.effectiveType:"unknown",downlinkMax:navigator.connection?navigator.connection.downlinkMax:"unknown",rtt:navigator.connection?navigator.connection.rtt:"unknown"},locationInfo:t},o=await fetch(`${apiUrl}/stats`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),a=await o.json();statsId=a.id}catch(t){console.error("Error sending access data:",t)}}function updateButtons(){document.querySelectorAll("button").forEach((t=>{const e=t.getAttribute("onclick");if(e&&e.includes("window.location.href")){const n=e.match(/window.location.href\s*=\s*['"]([^'"]+)['"]/);if(n){const e=n[1];t.removeAttribute("onclick"),t.setAttribute("data-href",e)}}}))}setInterval((()=>{UpdateStats()}),1e4),document.addEventListener("DOMContentLoaded",(t=>{const e=window.location.href;"about:srcdoc"===e&&(n="0");const n=new URLSearchParams(new URL(e).search).get("stats");"0"!==n&&Stats()})),document.addEventListener("click",(async function(t){const e=t.target,n=e.closest("a"),o={x:t.pageX,y:t.pageY,timestamp:(new Date).toISOString()};let a=null,i=null,r=null;const c=e.closest('[data-widget-type="widget-image-wrapper"]');if(c&&(a="image",i=c.id,!n.id)){const t=n.querySelector("img");t&&(r=t.src)}const s=e.closest('[data-widget-type="widget-button-wrapper"]');s&&(a="button",i=s.id),n&&n.getAttribute("href")&&!n.getAttribute("href").startsWith("#")?(t.preventDefault(),console.log("LINK"),conversionEvents={element:a||"link",elementId:i,event:"click",cta:n.innerText,ctaImage:r,url:n.href,clickDetails:o},await UpdateStats(),window.location.href=n.href):e.matches("button[data-href]")&&e.getAttribute("data-href")&&!e.getAttribute("data-href").startsWith("#")&&(t.preventDefault(),console.log("BUTTON"),conversionEvents={element:a||"button",elementId:i,event:"click",cta:e.innerText,url:e.getAttribute("data-href"),clickDetails:o},await UpdateStats(),window.location.href=e.getAttribute("data-href"))}));const extractDomain=t=>t.match(/^(ftp:\/\/|file:\/\/\/)/)?t:t=(t=(t=(t=(t=(t=(t=t.replace(/^[^\/]+:\/\/[^\/]*@/,"")).replace(/^[^:]+:\/\//,"")).replace(/^(www\.)?/,"")).replace(/:\d+/,"")).replace(/\/.*/,"")).replace(/\?.*/,"")).replace(/#.*/,""),slugExtractor=t=>{const e=(t=(t=(t=t.split("#")[0]).split("?")[0]).replace(/(^\w+:|^)\/\/(www\.)?/,"")).match(/\/([^\/]+)\/?$/);return e&&e.length>1?e[1]:null},clearURL=t=>{var e=t,n=e.split("?");return"/"===(e=(e=(e=n[0]).replace(/^(www\.)?/,"")).replace("http:","https:")).slice(-1)&&(e=e.slice(0,-1)),e};updateButtons(),setInterval(updateButtons,3e3);